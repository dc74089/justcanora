{% extends 'app/base.html' %}

{% block script %}
  <script>
      function load_conversation(conv_id) {
          $.get('{% url 'chat_assessment_results_convo' %}', {
              conv_id: conv_id
          }, function (data) {
              $('#conv_body').html("Loading...");
              $('#conversation-modal').modal('show');
              $('#conv_body').html(data);
          })
      }
  </script>
{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-12">
      <div class="accordion" id="accordionExample">
        {% for ac in convos %}
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ac-{{ ac.id }}"
                      aria-expanded="false" aria-controls="ac-{{ ac.id }}">
                {{ ac.assessment.short_name }}
              </button>
            </h2>
            <div id="ac-{{ ac.id }}" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <div class="progress">
                  <div class="progress-bar btn-grad" role="progressbar"
                       style="width: {{ ac.score_as_percent }}%"
                       aria-valuenow="{{ ac.score_as_percent }}"
                       aria-valuemin="0"
                       aria-valuemax="100"></div>
                </div>

                <h2 class="mt-3">Feedback</h2>
                <blockquote class="blockquote">
                  <p>{{ ac.feedback }}</p>
                </blockquote>

                <p class="text-center">
                  <a class="btn btn-grad-positive" onclick="load_conversation('{{ ac.id }}')">View Conversation</a>
                </p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endblock %}

{% block modals %}
  <div class="modal" tabindex="-1" id="conversation-modal" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="conv_title">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="conv_body">
        </div>
      </div>
    </div>
  </div>
{% endblock %}